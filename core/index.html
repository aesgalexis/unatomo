<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>unatomo core</title>
  <link rel="preload" href="./logo-unatomo-v1.5.svg" as="image" />
  <link rel="stylesheet" href="./core-styles.css" />
  <meta name="color-scheme" content="light dark" />
</head>
<body>

<!-- Bot√≥n tema (pill) -->
<button id="themeToggle" class="theme-toggle" type="button" aria-label="Cambiar tema" title="Cambiar tema">
  <span class="icon" aria-hidden="true">üåô</span>
  <span class="label">Light</span>
</button>

<script>
(() => {
  const STORAGE_KEY = 'ui-theme'; // 'light' | 'dark'
  const btn = document.getElementById('themeToggle');
  const metaColor = document.querySelector('meta[name="color-scheme"]');

  // Preferencia: guardada o blanco por defecto
  const saved = localStorage.getItem(STORAGE_KEY);
  const initial = (saved === 'light' || saved === 'dark') ? saved : 'light';
  applyTheme(initial);

  const mq = window.matchMedia('(prefers-color-scheme: dark)');
  const onChange = (e) => {
    const hasManual = localStorage.getItem(STORAGE_KEY);
    if (hasManual) return;
    applyTheme(e.matches ? 'dark' : 'light');
  };
  if (mq.addEventListener) mq.addEventListener('change', onChange);
  else if (mq.addListener) mq.addListener(onChange);

  btn?.addEventListener('click', () => {
    const next = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
    applyTheme(next);
    localStorage.setItem(STORAGE_KEY, next);
  });

  function applyTheme(mode) {
    document.documentElement.dataset.theme = mode;

    const icon  = mode === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    const text  = mode === 'dark' ? 'Light' : 'Dark'; // etiqueta visible
    const label = mode === 'dark' ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro';

    btn?.querySelector('.icon')?.replaceChildren(document.createTextNode(icon));
    btn?.querySelector('.label')?.replaceChildren(document.createTextNode(text));
    if (btn) {
      btn.setAttribute('aria-label', label);
      btn.setAttribute('title', label);
    }

    if (metaColor) metaColor.setAttribute('content', mode === 'dark' ? 'dark light' : 'light dark');
  }
})();
</script>

<div class="atom-tint" aria-hidden="true"></div>

<aside class="sidebar" role="navigation" aria-label="Navegaci√≥n principal">
  <!-- Logo: ir a Bienvenidos -->
  <a class="brand" href="#home" data-section="home">
    <img src="./logo-unatomo-v1.5.svg" alt="unatomo core logo" width="384" height="384" />
  </a>

 <nav class="menu" id="sidebar-menu">
  <div class="menu-item" data-key="home">
    <a href="#home" data-section="home" aria-current="page">Bienvenidos</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="seccion-1">
    <a href="#seccion-1" data-section="seccion-1">Asesor√≠a</a>
    <div class="submenu">
      <a href="#seccion-1-asesoria-tecnica" data-subsection="asesoria-tecnica">Asesor√≠a t√©cnica</a>
      <a href="#seccion-1-asesoria-procesos" data-subsection="asesoria-procesos">Asesor√≠a de procesos</a>
      <a href="#seccion-1-asesoria-operativa" data-subsection="asesoria-operativa">Asesor√≠a operativa</a>
    </div>
  </div>

  <div class="menu-item" data-key="seccion-2">
    <a href="#seccion-2" data-section="seccion-2">Ajustes y optimizaci√≥n</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="seccion-3">
    <a href="#seccion-3" data-section="seccion-3">Control de producci√≥n</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="seccion-4">
    <a href="#seccion-4" data-section="seccion-4">Mantenimiento</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="seccion-5">
    <a href="#seccion-5" data-section="seccion-5">Asistencia t√©cnica</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="seccion-6">
    <a href="#seccion-6" data-section="seccion-6">Formaci√≥n</a>
    <div class="submenu">
      <a href="#seccion-6-formacion-operarios" data-subsection="formacion-operarios">Formaci√≥n de operarios</a>
      <a href="#seccion-6-formacion-tecnicos" data-subsection="formacion-tecnicos">Formaci√≥n de equipos t√©cnicos</a>
    </div>
  </div>

  <div class="menu-item" data-key="seccion-7">
    <a href="#seccion-7" data-section="seccion-7">Alcance</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="seccion-8">
    <a href="#seccion-8" data-section="seccion-8">Contacto</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="seccion-9">
    <a href="#seccion-9" data-section="seccion-9">Cr√©ditos</a>
    <div class="submenu"></div>
  </div>
</nav>
</aside>

<main id="app" class="content" tabindex="-1">
  <!-- Bienvenidos -->
  <section id="section-home" data-section="home" class="section is-active">
    <h2>Sobre nosotros</h2>
    <p><strong>Your process, our insight.</strong></p>
    <p>Somos una empresa fundada en Mallorca, especializada en soluciones aplicadas y consultor√≠a de alto nivel para entornos de lavander√≠a industrial. Ofrecemos nuestros servicios en lavander√≠as de casi toda Europa, y algunos pa√≠ses del extranjero. 

Desarrollamos e implementamos soluciones de todo tipo para mejorar la operatividad, productividad y rentabilidad de nuestros clientes. Ayudamos a que su lavander√≠a funcione mejor, con cambios  estrat√©gicos aplicados y resultados tangibles.

Nos abalan casi 20 a√±os de experiencia directa en entornos de lavander√≠a industrial, siendo impulsores directos de cambios y mejoras en lavander√≠as industriales a d√≠a de hoy lideres y referentes en el sector.

Nuestro mayor impulsor es la pasi√≥n que sentimos, y principalmente yo, por lo que hacemos. Realmente disfrutamos ajustando un pliegue, eso hace que los resultados adem√°s de positivos sean excelentes y duraderos.

Colaboramos estrechamente con fabricantes del sector, y contamos con el apoyo y la colaboraci√≥n de una red de t√©cnicos por toda Espa√±a, siempre disponibles a cruzar fronteras si es preciso. Esto nos da el respaldo y la fortaleza de saber que no estamos solos, y nuestro objetivo, es que nuestros clientes tampoco. </p>
  </section>

  <!-- Secci√≥n 1: Asesor√≠a -->
  <section id="section-seccion-1" data-section="seccion-1" class="section">
    <h2>Asesor√≠a</h2>

    <h2 id="seccion-1-asesoria-tecnica">Asesor√≠a t√©cnica</h2>
    <p><strong>lo que mantiene las m√°quinas listas para trabajar</strong></p>
    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>

    <h2 id="seccion-1-asesoria-procesos">Asesor√≠a de procesos</h2>
    <p><strong>el ajuste fino para que nada se frene</strong></p>
    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>

    <h2 id="seccion-1-asesoria-operativa">Asesor√≠a operativa</h2>
    <p><strong>donde el uso diario convierte el plan en resultados</strong></p>
    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
  </section>

  <!-- Secci√≥n 2: Ajustes y optimizaci√≥n -->
  <section id="section-seccion-2" data-section="seccion-2" class="section">
    <h2>Ajustes y optimizaci√≥n</h2>
    <p><strong>que las m√°quinas rindan lo que pueden</strong></p>
    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
  </section>

  <!-- Secci√≥n 3: Control de producci√≥n -->
  <section id="section-seccion-3" data-section="seccion-3" class="section">
    <h2>Control de producci√≥n</h2>
    <p><strong>saber qu√© entra, qu√© sale y d√≥nde se atasca</strong></p>
    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
  </section>

  <!-- Secci√≥n 4: Mantenimiento -->
  <section id="section-seccion-4" data-section="seccion-4" class="section">
    <h2>Mantenimiento</h2>
    <p><strong>anticiparse para no parar</strong></p>
    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
  </section>

  <!-- Secci√≥n 5: Asistencia t√©cnica -->
  <section id="section-seccion-5" data-section="seccion-5" class="section">
    <h2>Asistencia t√©cnica</h2>
    <p><strong>cuando se para, lo ponemos en marcha</strong></p>
    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
  </section>

  <!-- Secci√≥n 6: Formaci√≥n -->
  <section id="section-seccion-6" data-section="seccion-6" class="section">
    <h2>Formaci√≥n</h2>

    <h2 id="seccion-6-formacion-operarios">Formaci√≥n de operarios</h2>
    <p><strong>trabajar sin frenos ni retrabajos</strong></p>
    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>

    <h2 id="seccion-6-formacion-tecnicos">Formaci√≥n de equipos t√©cnicos</h2>
    <p><strong>mantener y resolver sin improvisar</strong></p>
    <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.</p>
  </section>

  <!-- Secci√≥n 7: Alcance (Mapa) -->
  <section id="section-seccion-7" data-section="seccion-7" class="section">
    <h2>Alcance</h2>
    <h2>Mapa</h2>
    <p>Disponibilidad geogr√°fica para intervenciones y proyectos.</p>
    <div id="action-map" class="map" role="img" aria-label="Mapa de disponibilidad geogr√°fica"></div>
  </section>

  <!-- Secci√≥n 8: Contacto -->
  <section id="section-seccion-8" data-section="seccion-8" class="section">
    <h2>Contacto</h2>
    <p>Escr√≠benos y te respondemos a la mayor brevedad.</p>
  </section>

  <!-- Secci√≥n 9: Cr√©ditos -->
  <section id="section-seccion-9" data-section="seccion-9" class="section">
    <h2>Cr√©ditos</h2>
    <p>Referencias y agradecimientos del proyecto.</p>
  </section>
</main>



<script>
(function () {
  const app = document.getElementById('app');
  const sections = [...document.querySelectorAll('.section')];
  const brand = document.querySelector('.brand');
  const menuItems = [...document.querySelectorAll('.menu .menu-item')];

  // Submen√∫ abierto (null = ninguno). Por defecto queremos Bienvenidos abierto.
  let openKey = 'home';

  // Utilidad: slug simple si hiciera falta generar ids
  const slug = (t) => t.toLowerCase()
                      .trim()
                      .replace(/[^\p{L}\p{N}\s-]/gu,'')
                      .replace(/\s+/g,'-')
                      .replace(/-+/g,'-')
                      .slice(0,64);

  // Utilidad: quitar un wrapper .hl-wrap manteniendo su contenido
  function unwrap(el) {
    const parent = el.parentNode;
    while (el.firstChild) parent.insertBefore(el.firstChild, el);
    parent.removeChild(el);
  }

  // Activa una secci√≥n
  function activate(sectionKey) {
    sections.forEach(s => s.classList.toggle('is-active', s.dataset.section === sectionKey));
    menuItems.forEach(mi => {
      const a = mi.querySelector('a[data-section]');
      a.classList.toggle('is-active', a.dataset.section === sectionKey);
    });
    if (app) app.focus({ preventScroll: true });
  }

  // Visual de submen√∫ abierto
  function updateOpenVisual() {
    menuItems.forEach(mi => mi.classList.toggle('is-open', mi.dataset.key === openKey));
  }

  // Reset de un submen√∫ y su contenido (quita estado de subitems y resaltados)
  function resetSubmenu(key) {
    if (!key) return;
    const mi = document.querySelector(`.menu .menu-item[data-key="${key}"]`);
    if (mi) mi.querySelectorAll('.submenu a.is-sub-active').forEach(a => a.classList.remove('is-sub-active'));

    const sec = document.querySelector(`.section[data-section="${key}"]`);
    if (sec) {
      sec.querySelectorAll('h2.is-highlighted, h3.is-highlighted').forEach(h => h.classList.remove('is-highlighted'));
      sec.querySelectorAll('.hl-wrap').forEach(unwrap);
    }
  }

  // Abre/cierra submen√∫s (y resetea cuando corresponde)
  function setOpen(nextKey) {
    const prev = openKey;
    openKey = nextKey;
    updateOpenVisual();

    if (prev && prev !== nextKey) resetSubmenu(prev);
    if (nextKey === null) resetSubmenu(prev);
  }

  // Construye submen√∫s desde h2/h3 de cada secci√≥n
  function buildSubmenus() {
    menuItems.forEach(mi => {
      const key = mi.dataset.key;
      const section = sections.find(s => s.dataset.section === key);
      const box = mi.querySelector('.submenu');
      if (!box || !section) return;

      box.innerHTML = '';
      const heads = [...section.querySelectorAll('h2, h3')];

      heads.forEach((h, idx) => {
        if (!h.id) {
          const base = slug(h.textContent || `sub-${idx+1}`);
          let id = base, n = 1;
          while (document.getElementById(id)) id = `${base}-${n++}`;
          h.id = id;
        }

        const a = document.createElement('a');
        a.href = `#${key}`;
        a.dataset.section = key;
        a.dataset.target = h.id;
        a.textContent = h.textContent.trim();

        a.addEventListener('click', (e) => {
          e.preventDefault();

          // Activa la secci√≥n si no lo est√°
          if (!section.classList.contains('is-active')) {
            history.pushState({ key }, '', `#${key}`);
            activate(key);
          }

          // Marca este subitem y desmarca el resto dentro de este submen√∫
          box.querySelectorAll('a').forEach(x => x.classList.toggle('is-sub-active', x === a));

          // Limpia resaltados previos de ESTE section y aplica nuevo wrapper
          section.querySelectorAll('.hl-wrap').forEach(unwrap);
          section.querySelectorAll('h2.is-highlighted, h3.is-highlighted').forEach(x => x.classList.remove('is-highlighted'));

          if (!h.querySelector('.hl-wrap')) {
            const span = document.createElement('span');
            span.className = 'hl-wrap';
            while (h.firstChild) span.appendChild(h.firstChild);
            h.appendChild(span);
          }
          h.classList.add('is-highlighted');
          h.scrollIntoView({ behavior: 'smooth', block: 'start' });

          // Mantener abierto este submen√∫
          setOpen(key);
        });

        box.appendChild(a);
      });
    });
  }

  // Click en top-level: toggle abrir/cerrar, y navegar a su secci√≥n
  function wireTopLevel() {
    menuItems.forEach(mi => {
      const a = mi.querySelector('a[data-section]');
      const key = a.dataset.section;

      a.addEventListener('click', (e) => {
        e.preventDefault();
        const willClose = openKey === key; // segundo clic sobre el mismo => colapsa

        history.pushState({ key }, '', `#${key}`);
        activate(key);
        setOpen(willClose ? null : key); // si colapsa, resetea subitems y marcado
      });
    });
  }

  // Logo: a "home" y abre solo su submen√∫ (resetea el que estuviera)
  brand.addEventListener('click', (e) => {
    e.preventDefault();
    const key = 'home';
    history.pushState({ key }, '', `#${key}`);
    activate(key);
    setOpen('home');
  });

  // Arranque: ir a hash v√°lido o a home; submen√∫ abierto solo en "home"
  const initialKey = 'home';
  const fromHash = (location.hash || `#${initialKey}`).slice(1);
  const valid = sections.some(s => s.dataset.section === fromHash);
  const startKey = valid ? fromHash : initialKey;
  if (startKey !== fromHash) history.replaceState({ key: initialKey }, '', `#${initialKey}`);

  buildSubmenus();
  wireTopLevel();
  activate(startKey);
  setOpen('home'); // todos colapsados salvo Bienvenidos

  // Back/forward: sincroniza secci√≥n y abre su submen√∫
  window.addEventListener('popstate', () => {
    const key = (location.hash || '#home').slice(1);
    activate(key);
    setOpen(key);
  });
})();
</script>

<!-- MAPA (D3 + TopoJSON) -->
<script type="module">
import { geoMercator, geoPath } from "https://esm.sh/d3-geo@3";
import { feature } from "https://esm.sh/topojson-client@3";

const container = document.getElementById("action-map");

/* Pa√≠ses permitidos (ISO 3166-1 alpha-2) -> azul */
const ALLOWED = new Set([
  "ES","PT","FR","DE","IT","GB","IE","BE","NL","LU","CH","AT",
  "DK","NO","SE","FI","PL","CZ","SK","HU","SI","HR","BA","RS","ME","MK","AL",
  "GR","BG","RO","MD","UA","LT","LV","EE","IS","TR","CY","MT","AD","MC","SM",
  "VA","LI"/*, "MA","TN","DZ" si quieres norte de √Åfrica */
]);

/* world-atlas usa IDs num√©ricos (ISO numeric). Mapeo m√≠nimo -> alpha-2 */
const NUM_TO_A2 = {
  "724":"ES","620":"PT","250":"FR","276":"DE","380":"IT","826":"GB","372":"IE",
  "056":"BE","528":"NL","442":"LU","756":"CH","040":"AT","208":"DK","578":"NO",
  "752":"SE","246":"FI","616":"PL","203":"CZ","703":"SK","348":"HU","705":"SI",
  "191":"HR","070":"BA","688":"RS","499":"ME","807":"MK","008":"AL","300":"GR",
  "100":"BG","642":"RO","498":"MD","804":"UA","440":"LT","428":"LV","233":"EE",
  "352":"IS","792":"TR","196":"CY","470":"MT","020":"AD","492":"MC","674":"SM",
  "336":"VA","438":"LI","112":"BY","643":"RU"
};

async function loadTopology() {
  // 1) Intenta local
  try {
    const r = await fetch("./assets/countries-110m.json", { cache: "force-cache" });
    if (r.ok) return r.json();
    throw new Error("local not found");
  } catch {
    // 2) Fallback CDN
    const r = await fetch("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json");
    return r.json();
  }
}

function drawMap(topo) {
  if (!container) return;

  // Base virtual 700x500; el SVG escalar√° con CSS (aspect-ratio)
  const W = 700, H = 500, PAD = 12;

  // Crea SVG
  container.innerHTML = "";
  const svgNS = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(svgNS, "svg");
  svg.setAttribute("viewBox", `0 0 ${W} ${H}`);
  svg.setAttribute("width", "100%");
  svg.setAttribute("height", "100%");
  container.appendChild(svg);

  const proj = geoMercator();
  const path = geoPath(proj, null);

  // Enfocar Europa con un bbox aproximado
  const europeBBox = { type:"Polygon", coordinates:[[[-25,32],[40,32],[40,72],[-25,72],[-25,32]]] };

  proj.fitExtent([[PAD, PAD], [W - PAD, H - PAD]], europeBBox);

  const countries = feature(topo, topo.objects.countries).features;

  // Dibujo
  const g = document.createElementNS(svgNS, "g");
  svg.appendChild(g);

  for (const f of countries) {
    const id = String(f.id).padStart(3, "0");
    const a2 = NUM_TO_A2[id];
    const p = document.createElementNS(svgNS, "path");
    p.setAttribute("d", path(f));
    p.setAttribute("class", `country${a2 && ALLOWED.has(a2) ? " allowed" : ""}`);
    p.setAttribute("data-iso", a2 || id);
    g.appendChild(p);
  }
}

(async () => {
  const topo = await loadTopology();
  drawMap(topo);
})();
</script>

</body>
</html>
