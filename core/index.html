<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>unatomo core</title>
  <link rel="preload" href="./logo-unatomo-v1.5.svg" as="image" />
  <link rel="stylesheet" href="./core-styles.css" />
  <meta name="color-scheme" content="light dark" />
</head>
<body>

<!-- Bot√≥n tema (pill) -->
<button id="themeToggle" class="theme-toggle" type="button" aria-label="Cambiar tema" title="Cambiar tema">
  <span class="icon" aria-hidden="true">üåô</span>
  <span class="label">Light</span>
</button>

<script>
(() => {
  const STORAGE_KEY = 'ui-theme'; // 'light' | 'dark'
  const btn = document.getElementById('themeToggle');
  const metaColor = document.querySelector('meta[name="color-scheme"]');

  // Preferencia: guardada o blanco por defecto
  const saved = localStorage.getItem(STORAGE_KEY);
  const initial = (saved === 'light' || saved === 'dark') ? saved : 'light';
  applyTheme(initial);

  const mq = window.matchMedia('(prefers-color-scheme: dark)');
  const onChange = (e) => {
    const hasManual = localStorage.getItem(STORAGE_KEY);
    if (hasManual) return;
    applyTheme(e.matches ? 'dark' : 'light');
  };
  if (mq.addEventListener) mq.addEventListener('change', onChange);
  else if (mq.addListener) mq.addListener(onChange);

  btn?.addEventListener('click', () => {
    const next = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
    applyTheme(next);
    localStorage.setItem(STORAGE_KEY, next);
  });

  function applyTheme(mode) {
    document.documentElement.dataset.theme = mode;

    const icon  = mode === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    const text  = mode === 'dark' ? 'Light' : 'Dark'; // etiqueta visible
    const label = mode === 'dark' ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro';

    btn?.querySelector('.icon')?.replaceChildren(document.createTextNode(icon));
    btn?.querySelector('.label')?.replaceChildren(document.createTextNode(text));
    if (btn) {
      btn.setAttribute('aria-label', label);
      btn.setAttribute('title', label);
    }

    if (metaColor) metaColor.setAttribute('content', mode === 'dark' ? 'dark light' : 'light dark');
  }
})();
</script>

<div class="atom-tint" aria-hidden="true"></div>

<aside class="sidebar" role="navigation" aria-label="Navegaci√≥n principal">
  <!-- Logo: ir a Welcome -->
  <a class="brand" href="#home" data-section="home">
    <img src="./logo-unatomo-v1.5.svg" alt="unatomo core logo" width="384" height="384" />
  </a>

  <!-- Men√∫ con contenedores .menu-item; los submenus se rellenan por JS -->
  <nav class="menu" id="sidebar-menu">
  <div class="menu-item" data-key="home">
    <a href="#home" data-section="home" aria-current="page">Bienvenidos</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="servicios-generales">
    <a href="#servicios-generales" data-section="servicios-generales">Servicios generales</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="servicios-especificos">
    <a href="#servicios-especificos" data-section="servicios-especificos">Servicios espec√≠ficos</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="otros-servicios">
    <a href="#otros-servicios" data-section="otros-servicios">Otros servicios</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="alcance">
    <a href="#alcance" data-section="alcance">Alcance</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="cita">
    <a href="#cita" data-section="cita">Solicitar una cita</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="contacto">
    <a href="#contacto" data-section="contacto">Contacto</a>
    <div class="submenu"></div>
  </div>

  <div class="menu-item" data-key="creditos">
    <a href="#creditos" data-section="creditos">Cr√©ditos</a>
    <div class="submenu"></div>
  </div>
</nav>

</aside>

<main id="app" class="content" tabindex="-1">
  <!-- Bienvenidos -->
  <section id="section-home" data-section="home" class="section is-active">
    <h2>Sobre nosotros</h2>
    <p><strong>Your process, our insight.</strong></p>
    <p>Somos una empresa fundada en Mallorca, especializada en soluciones aplicadas y consultor√≠a de alto nivel para entornos de lavander√≠a industrial.</p>
  </section>

  <!-- Servicios generales -->
  <section id="section-servicios-generales" data-section="servicios-generales" class="section">
    <h2>Asesor√≠a t√©cnica</h2>
    <p>Evaluaci√≥n de procesos, recomendaciones de mejora y acompa√±amiento t√©cnico.</p>

    <h2>Auditor√≠a</h2>
    <p>An√°lisis integral de rendimiento, consumo y calidad, con informe accionable.</p>

    <h2>Formaci√≥n</h2>
    <p>Programas pr√°cticos para equipos operativos y mandos intermedios.</p>
  </section>

  <!-- Servicios espec√≠ficos -->
  <section id="section-servicios-especificos" data-section="servicios-especificos" class="section">
    <h2>Maquinaria</h2>
    <p>Selecci√≥n, configuraci√≥n y validaci√≥n de equipos para cada entorno.</p>

    <h2>Instalaciones</h2>
    <p>Dise√±o y optimizaci√≥n de layout, flujos y utilidades.</p>

    <h2>Suministros</h2>
    <p>Asesor√≠a en qu√≠micos, consumibles y contratos de aprovisionamiento.</p>
  </section>

  <!-- Otros servicios -->
  <section id="section-otros-servicios" data-section="otros-servicios" class="section">
    <h2>Herramientas de control de producci√≥n</h2>
    <p>Cuadros de mando, trazabilidad y m√©tricas para la toma de decisiones.</p>
  </section>

  <!-- Alcance -->
  <section id="section-alcance" data-section="alcance" class="section">
    <h2>Mapa</h2>
    <p>Disponibilidad geogr√°fica para intervenciones y proyectos.</p>
    <div id="action-map" class="map" role="img" aria-label="Mapa de disponibilidad geogr√°fica"></div>
  </section>

  <!-- Solicitar una cita -->
  <section id="section-cita" data-section="cita" class="section">
    <h2>Solicitar una cita</h2>
    <p>Cu√©ntanos brevemente tu necesidad y proponemos fecha para la primera reuni√≥n.</p>
  </section>

  <!-- Contacto -->
  <section id="section-contacto" data-section="contacto" class="section">
    <h2>Contacto</h2>
    <p>Escr√≠benos y te respondemos a la mayor brevedad.</p>
  </section>

  <!-- Cr√©ditos -->
  <section id="section-creditos" data-section="creditos" class="section">
    <h2>Cr√©ditos</h2>
    <p>Referencias y agradecimientos del proyecto.</p>
  </section>
</main>


<script>
(function () {
  const app = document.getElementById('app');
  const sections = [...document.querySelectorAll('.section')];
  const brand = document.querySelector('.brand');
  const menuItems = [...document.querySelectorAll('.menu .menu-item')];

  // Submen√∫ abierto (null = ninguno). Por defecto queremos Welcome abierto.
  let openKey = 'home';

  // Utilidad: slug simple si hiciera falta generar ids
  const slug = (t) => t.toLowerCase()
                      .trim()
                      .replace(/[^\p{L}\p{N}\s-]/gu,'')
                      .replace(/\s+/g,'-')
                      .replace(/-+/g,'-')
                      .slice(0,64);

  // Activa una secci√≥n (no gestiona abrir/cerrar submen√∫s)
  function activate(sectionKey) {
    sections.forEach(s => s.classList.toggle('is-active', s.dataset.section === sectionKey));
    menuItems.forEach(mi => {
      const a = mi.querySelector('a[data-section]');
      a.classList.toggle('is-active', a.dataset.section === sectionKey);
    });
    if (app) app.focus({ preventScroll: true });
  }

  // Poner/quitar clase visual de "abierto" en el men√∫
  function updateOpenVisual() {
    menuItems.forEach(mi => mi.classList.toggle('is-open', mi.dataset.key === openKey));
  }

  // Reset de un submen√∫ y su contenido: quita el "verde" del subitem
  // y el marcado amarillo del t√≠tulo dentro de la secci√≥n correspondiente.
  function resetSubmenu(key) {
    if (!key) return;
    const mi = document.querySelector(`.menu .menu-item[data-key="${key}"]`);
    if (mi) mi.querySelectorAll('.submenu a.is-sub-active').forEach(a => a.classList.remove('is-sub-active'));
    const sec = document.querySelector(`.section[data-section="${key}"]`);
    if (sec) sec.querySelectorAll('h2.is-highlighted, h3.is-highlighted').forEach(h => h.classList.remove('is-highlighted'));
  }

  // Abre un submen√∫ o colapsa todos. Si se cierra el que estaba abierto,
  // reseteamos sus subitems y resaltados.
  function setOpen(nextKey) {
    const prev = openKey;
    openKey = nextKey;
    updateOpenVisual();

    // Si hemos cambiado de submen√∫, resetea el anterior.
    if (prev && prev !== nextKey) resetSubmenu(prev);

    // Si hemos colapsado (nextKey === null), resetea el que estaba abierto.
    if (nextKey === null) resetSubmenu(prev);
  }

  // Construye submen√∫s desde h2/h3 de cada secci√≥n
  function buildSubmenus() {
    menuItems.forEach(mi => {
      const key = mi.dataset.key;
      const section = sections.find(s => s.dataset.section === key);
      const box = mi.querySelector('.submenu');
      if (!box || !section) return;

      box.innerHTML = '';
      const heads = [...section.querySelectorAll('h2, h3')];

      heads.forEach((h, idx) => {
        if (!h.id) {
          const base = slug(h.textContent || `sub-${idx+1}`);
          let id = base, n = 1;
          while (document.getElementById(id)) id = `${base}-${n++}`;
          h.id = id;
        }

        const a = document.createElement('a');
        a.href = `#${key}`;
        a.dataset.section = key;
        a.dataset.target = h.id;
        a.textContent = h.textContent.trim();

        a.addEventListener('click', (e) => {
          e.preventDefault();

          // Activa la secci√≥n si no lo est√°
          if (!section.classList.contains('is-active')) {
            history.pushState({ key }, '', `#${key}`);
            activate(key);
          }

          // Marca este subitem en verde y desmarca el resto (solo dentro de este submen√∫)
          box.querySelectorAll('a').forEach(x => x.classList.toggle('is-sub-active', x === a));

          // Limpia resaltados de esta secci√≥n y marca el destino en amarillo
          section.querySelectorAll('h2.is-highlighted, h3.is-highlighted')
                 .forEach(x => x.classList.remove('is-highlighted'));
          h.classList.add('is-highlighted');
          h.scrollIntoView({ behavior: 'smooth', block: 'start' });

          // Mant√©n este submen√∫ abierto
          setOpen(key);
        });

        box.appendChild(a);
      });
    });
  }

  // Click en top-level: toggle abrir/cerrar, y navegar a su secci√≥n
  function wireTopLevel() {
    menuItems.forEach(mi => {
      const a = mi.querySelector('a[data-section]');
      const key = a.dataset.section;

      a.addEventListener('click', (e) => {
        e.preventDefault();
        const willClose = openKey === key; // segundo clic sobre el mismo => colapsa

        history.pushState({ key }, '', `#${key}`);
        activate(key);
        setOpen(willClose ? null : key); // si colapsa, resetea subitems y marcado
      });
    });
  }

  // Logo: a "home" y abre solo su submen√∫ (resetea el que estuviera)
  brand.addEventListener('click', (e) => {
    e.preventDefault();
    const key = 'home';
    history.pushState({ key }, '', `#${key}`);
    activate(key);
    setOpen('home');
  });

  // Arranque: ir a hash v√°lido o a home; submen√∫ abierto solo en "home"
  const initialKey = 'home';
  const fromHash = (location.hash || `#${initialKey}`).slice(1);
  const valid = sections.some(s => s.dataset.section === fromHash);
  const startKey = valid ? fromHash : initialKey;
  if (startKey !== fromHash) history.replaceState({ key: initialKey }, '', `#${initialKey}`);

  buildSubmenus();
  wireTopLevel();
  activate(startKey);
  setOpen('home'); // todos colapsados salvo Bienvenidos

  // Back/forward: sincroniza secci√≥n y abre su submen√∫
  window.addEventListener('popstate', () => {
    const key = (location.hash || '#home').slice(1);
    activate(key);
    setOpen(key);
  });
})();
</script>



  
  <script type="module">
import { geoMercator, geoPath } from "https://esm.sh/d3-geo@3";
import { feature } from "https://esm.sh/topojson-client@3";

const container = document.getElementById("action-map");

/* Pa√≠ses permitidos (ISO 3166-1 alpha-2) -> azul
   Ajusta la lista a tu gusto. He puesto Europa amplia por defecto. */
const ALLOWED = new Set([
  "ES","PT","FR","DE","IT","GB","IE","BE","NL","LU","CH","AT",
  "DK","NO","SE","FI","PL","CZ","SK","HU","SI","HR","BA","RS","ME","MK","AL",
  "GR","BG","RO","MD","UA","LT","LV","EE","IS","TR","CY","MT","AD","MC","SM",
  "VA","LI"/*, "MA","TN","DZ" si quieres norte de √Åfrica */
]);

/* world-atlas usa IDs num√©ricos (ISO numeric). Mapeo m√≠nimo -> alpha-2 */
const NUM_TO_A2 = {
  "724":"ES","620":"PT","250":"FR","276":"DE","380":"IT","826":"GB","372":"IE",
  "056":"BE","528":"NL","442":"LU","756":"CH","040":"AT","208":"DK","578":"NO",
  "752":"SE","246":"FI","616":"PL","203":"CZ","703":"SK","348":"HU","705":"SI",
  "191":"HR","070":"BA","688":"RS","499":"ME","807":"MK","008":"AL","300":"GR",
  "100":"BG","642":"RO","498":"MD","804":"UA","440":"LT","428":"LV","233":"EE",
  "352":"IS","792":"TR","196":"CY","470":"MT","020":"AD","492":"MC","674":"SM",
  "336":"VA","438":"LI","112":"BY","643":"RU"
};

async function loadTopology() {
  // 1) Intenta local (recomendado para 100% offline)
  try {
    const r = await fetch("./assets/countries-110m.json", { cache: "force-cache" });
    if (r.ok) return r.json();
    throw new Error("local not found");
  } catch {
    // 2) Fallback CDN
    const r = await fetch("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json");
    return r.json();
  }
}

function drawMap(topo) {
  // Base virtual 700x500; el SVG escalar√° con CSS (aspect-ratio)
  const W = 700, H = 500, PAD = 12;

  // Crea SVG
  container.innerHTML = "";
  const svgNS = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(svgNS, "svg");
  svg.setAttribute("viewBox", `0 0 ${W} ${H}`);
  svg.setAttribute("width", "100%");
  svg.setAttribute("height", "100%");
  container.appendChild(svg);

  const proj = geoMercator();
  const path = geoPath(proj, null);

  // Enfocar Europa con un bbox aproximado
  const europeBBox = { type:"Polygon", coordinates:[[[-25,32],[40,32],[40,72],[-25,72],[-25,32]]] };

  proj.fitExtent([[PAD, PAD], [W - PAD, H - PAD]], europeBBox);

  const countries = feature(topo, topo.objects.countries).features;

  // Dibujo
  const g = document.createElementNS(svgNS, "g");
  svg.appendChild(g);

  for (const f of countries) {
    const id = String(f.id).padStart(3, "0");
    const a2 = NUM_TO_A2[id]; // undefined si no mapeado (no pasa nada)
    const p = document.createElementNS(svgNS, "path");
    p.setAttribute("d", path(f));
    p.setAttribute("class", `country${a2 && ALLOWED.has(a2) ? " allowed" : ""}`);
    p.setAttribute("data-iso", a2 || id);
    g.appendChild(p);
  }
}

(async () => {
  const topo = await loadTopology();
  drawMap(topo);
})();
</script>


</body>
</html>
