<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>unatomo core</title>
  <link rel="preload" href="./logo-unatomo-v1.5.svg" as="image" />
  <link rel="stylesheet" href="./core-styles.css" />
  <meta name="color-scheme" content="light dark" />
</head>
<body>

<!-- Bot√≥n tema (pill) -->
<button id="themeToggle" class="theme-toggle" type="button" aria-label="Cambiar tema" title="Cambiar tema">
  <span class="icon" aria-hidden="true">üåô</span>
  <span class="label">Light</span>
</button>

<script>
(() => {
  const STORAGE_KEY = 'ui-theme'; // 'light' | 'dark'
  const btn = document.getElementById('themeToggle');
  const metaColor = document.querySelector('meta[name="color-scheme"]');

  // Preferencia: guardada o blanco por defecto
  const saved = localStorage.getItem(STORAGE_KEY);
  const initial = (saved === 'light' || saved === 'dark') ? saved : 'light';
  applyTheme(initial);

  const mq = window.matchMedia('(prefers-color-scheme: dark)');
  const onChange = (e) => {
    const hasManual = localStorage.getItem(STORAGE_KEY);
    if (hasManual) return;
    applyTheme(e.matches ? 'dark' : 'light');
  };
  if (mq.addEventListener) mq.addEventListener('change', onChange);
  else if (mq.addListener) mq.addListener(onChange);

  btn?.addEventListener('click', () => {
    const next = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
    applyTheme(next);
    localStorage.setItem(STORAGE_KEY, next);
  });

  function applyTheme(mode) {
    document.documentElement.dataset.theme = mode;

    const icon  = mode === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    const text  = mode === 'dark' ? 'Light' : 'Dark'; // etiqueta visible
    const label = mode === 'dark' ? 'Cambiar a modo claro' : 'Cambiar a modo oscuro';

    btn?.querySelector('.icon')?.replaceChildren(document.createTextNode(icon));
    btn?.querySelector('.label')?.replaceChildren(document.createTextNode(text));
    if (btn) {
      btn.setAttribute('aria-label', label);
      btn.setAttribute('title', label);
    }

    if (metaColor) metaColor.setAttribute('content', mode === 'dark' ? 'dark light' : 'light dark');
  }
})();
</script>

<div class="atom-tint" aria-hidden="true"></div>

<aside class="sidebar" role="navigation" aria-label="Navegaci√≥n principal">
  <!-- Logo: ir a Welcome -->
  <a class="brand" href="#home" data-section="home">
    <img src="./logo-unatomo-v1.5.svg" alt="unatomo core logo" width="384" height="384" />
  </a>

  <!-- Men√∫ con contenedores .menu-item; los submenus se rellenan por JS -->
  <nav class="menu" id="sidebar-menu">
    <div class="menu-item" data-key="home">
      <a href="#home" data-section="home" aria-current="page">Welcome</a>
      <div class="submenu"></div>
    </div>
    
    <div class="menu-item" data-key="action">
      <a href="#action" data-section="action">Acci√≥n</a>
      <div class="submenu"></div>
    </div>

    <div class="menu-item" data-key="enlace-1">
      <a href="#enlace-1" data-section="enlace-1">Enlace 1</a>
      <div class="submenu"></div>
    </div>

    <div class="menu-item" data-key="enlace-2">
      <a href="#enlace-2" data-section="enlace-2">Enlace 2</a>
      <div class="submenu"></div>
    </div>

    <div class="menu-item" data-key="enlace-3">
      <a href="#enlace-3" data-section="enlace-3">Enlace 3</a>
      <div class="submenu"></div>
    </div>

    <div class="menu-item" data-key="enlace-4">
      <a href="#enlace-4" data-section="enlace-4">Enlace 4</a>
      <div class="submenu"></div>
    </div>

    <div class="menu-item" data-key="enlace-5">
      <a href="#enlace-5" data-section="enlace-5">Enlace 5</a>
      <div class="submenu"></div>
    </div>
  </nav>
</aside>

<main id="app" class="content" tabindex="-1">
  <section id="section-home" data-section="home" class="section is-active">
    <h1>Welcome</h1>

    <!-- Ejemplo de subt√≠tulos (h2/h3) que aparecer√°n en el submenu -->
    <h2>Overview</h2>
    <p><strong>Your process, our insight.</strong></p>
    <p>We are a company specializing in high-level solutions and consulting for industrial laundry environments.</p>

    <h2>Capabilities</h2>
    <p>Auditor√≠as t√©cnicas, optimizaci√≥n de procesos, formaci√≥n, integraci√≥n de maquinaria y software.</p>

    <h3>Methodology</h3>
    <p>Enfoque pragm√°tico con m√©tricas claras y mejoras iterativas.</p>
  </section>
  
  <section id="section-action" data-section="action" class="section">
  <h1>Acci√≥n</h1>
  <h2>Disponibilidad geogr√°fica</h2>
  <p>Estos son los pa√≠ses a los que viajo para reparar/asesorar.</p>

  <!-- Contenedor del mapa -->
  <div id="action-map" class="map" role="img" aria-label="Mapa de disponibilidad geogr√°fica"></div>
  </section>

  <section id="section-enlace-1" data-section="enlace-1" class="section">
    <h1>Enlace 1</h1>
    <h2>Subt√≠tulo 1.1</h2>
    <p>Contenido de ejemplo para el Enlace 1.</p>
    <h2>Subt√≠tulo 1.2</h2>
    <p>M√°s contenido.</p>
  </section>

  <section id="section-enlace-2" data-section="enlace-2" class="section">
    <h1>Enlace 2</h1>
    <h2>Introducci√≥n</h2>
    <p>Contenido de ejemplo para el Enlace 2.</p>
  </section>

  <section id="section-enlace-3" data-section="enlace-3" class="section">
    <h1>Enlace 3</h1>
    <h2>Resumen</h2>
    <p>Contenido de ejemplo para el Enlace 3.</p>
  </section>

  <section id="section-enlace-4" data-section="enlace-4" class="section">
    <h1>Enlace 4</h1>
    <h2>Notas</h2>
    <p>Contenido de ejemplo para el Enlace 4.</p>
  </section>

  <section id="section-enlace-5" data-section="enlace-5" class="section">
    <h1>Enlace 5</h1>
    <h2>Detalles</h2>
    <p>Contenido de ejemplo para el Enlace 5.</p>
  </section>
</main>

<script>
(function () {
  const app = document.getElementById('app');
  const sections = [...document.querySelectorAll('.section')];
  const brand = document.querySelector('.brand');
  const menuItems = [...document.querySelectorAll('.menu .menu-item')];
let __kbdNav = false;
window.addEventListener('keydown', (e) => {
  const keys = ['Tab','ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Home','End','PageUp','PageDown'];
  if (keys.includes(e.key)) __kbdNav = true;
});
['mousedown','pointerdown','touchstart'].forEach(ev =>
  window.addEventListener(ev, () => { __kbdNav = false; })
);

  // Estado: cu√°l submenu est√° abierto (null => ninguno)
  let openKey = null;

  // Utilidad: slug para IDs
  const slug = (t) => t.toLowerCase()
                      .trim()
                      .replace(/[^\p{L}\p{N}\s-]/gu,'')
                      .replace(/\s+/g,'-')
                      .replace(/-+/g,'-')
                      .slice(0,64);

  // Aplica la secci√≥n activa (no toca el estado abierto/cerrado)
  function activate(sectionKey) {
    sections.forEach(s => s.classList.toggle('is-active', s.dataset.section === sectionKey));
    menuItems.forEach(mi => {
      const a = mi.querySelector('a[data-section]');
      const isActive = a.dataset.section === sectionKey;
      a.classList.toggle('is-active', isActive);
    });
    app && app.focus({ preventScroll: true });
  }

  // Visual del abierto/cerrado (solo cero o uno a la vez)
  function updateOpenVisual() {
    menuItems.forEach(mi => mi.classList.toggle('is-open', mi.dataset.key === openKey));
  }
  function setOpen(nextKey) {
    openKey = nextKey;
    updateOpenVisual();
  }

  // Construye submenus desde h2/h3
  function buildSubmenus() {
    menuItems.forEach(mi => {
      const key = mi.dataset.key;
      const section = sections.find(s => s.dataset.section === key);
      const box = mi.querySelector('.submenu');
      if (!box || !section) return;

      box.innerHTML = '';
      const heads = [...section.querySelectorAll('h2, h3')];

      heads.forEach((h, idx) => {
        if (!h.id) {
          const base = slug(h.textContent || `sub-${idx+1}`);
          let id = base, n = 1;
          while (document.getElementById(id)) id = `${base}-${n++}`;
          h.id = id;
        }

        const a = document.createElement('a');
        a.href = `#${key}`;
        a.dataset.section = key;
        a.dataset.target = h.id;
        a.textContent = h.textContent.trim();

        a.addEventListener('click', (e) => {
          e.preventDefault();
          // activa secci√≥n si no lo est√°
          if (!section.classList.contains('is-active')) {
            history.pushState({ key }, '', `#${key}`);
            activate(key);
          }
          // subitem activo en el submenu
          box.querySelectorAll('a').forEach(x => x.classList.toggle('is-sub-active', x === a));
          // quita resaltados previos y resalta el h2/h3 destino
          document.querySelectorAll('.is-highlighted').forEach(x => x.classList.remove('is-highlighted'));
          h.classList.add('is-highlighted');
          h.scrollIntoView({ behavior: 'smooth', block: 'start' });

          // mantiene abierto este submenu
          setOpen(key);
        });

        box.appendChild(a);
      });
    });
  }

  // Click en top-level: navegar y abrir/cerrar (toggle en segundo clic)
  function wireTopLevel() {
    menuItems.forEach(mi => {
      const a = mi.querySelector('a[data-section]');
      const key = a.dataset.section;

      a.addEventListener('click', (e) => {
        e.preventDefault();

        const isAlreadyActive = document.querySelector(`.section.is-active`)?.dataset.section === key;
        const willClose = openKey === key; // si ya est√° abierto y clicas, cerramos

        // Navega/activa siempre a la secci√≥n del bot√≥n
        history.pushState({ key }, '', `#${key}`);
        activate(key);

        // Toggle del submenu: si estaba abierto => cerrar (openKey=null),
        // si no lo estaba => abrir este y cerrar los dem√°s.
        setOpen(willClose ? null : key);
      });
    });
  }

  // Logo: ir a Welcome y abrir su submenu
  brand.addEventListener('click', (e) => {
    e.preventDefault();
    const key = 'home';
    history.pushState({ key }, '', `#${key}`);
    activate(key);
    setOpen('home');
  });

  // Arranque: home si hash inv√°lido; submenu: solo Welcome abierto
  const initialKey = 'home';
  const fromHash = (location.hash || `#${initialKey}`).slice(1);
  const valid = sections.some(s => s.dataset.section === fromHash);
  const startKey = valid ? fromHash : initialKey;
  if (startKey !== fromHash) history.replaceState({ key: initialKey }, '', `#${initialKey}`);

  buildSubmenus();
  wireTopLevel();
  activate(startKey);
  setOpen('home'); // todos colapsados excepto Welcome

  // Back/forward: sincroniza secci√≥n y (opcional) abre su submenu
  window.addEventListener('popstate', () => {
    const key = (location.hash || '#home').slice(1);
    activate(key);
    setOpen(key); // si prefieres no abrirlo en back/forward, usa: setOpen(null);
  });
})();
</script>


  
  <script type="module">
import { geoMercator, geoPath } from "https://esm.sh/d3-geo@3";
import { feature } from "https://esm.sh/topojson-client@3";

const container = document.getElementById("action-map");

/* Pa√≠ses permitidos (ISO 3166-1 alpha-2) -> azul
   Ajusta la lista a tu gusto. He puesto Europa amplia por defecto. */
const ALLOWED = new Set([
  "ES","PT","FR","DE","IT","GB","IE","BE","NL","LU","CH","AT",
  "DK","NO","SE","FI","PL","CZ","SK","HU","SI","HR","BA","RS","ME","MK","AL",
  "GR","BG","RO","MD","UA","LT","LV","EE","IS","TR","CY","MT","AD","MC","SM",
  "VA","LI"/*, "MA","TN","DZ" si quieres norte de √Åfrica */
]);

/* world-atlas usa IDs num√©ricos (ISO numeric). Mapeo m√≠nimo -> alpha-2 */
const NUM_TO_A2 = {
  "724":"ES","620":"PT","250":"FR","276":"DE","380":"IT","826":"GB","372":"IE",
  "056":"BE","528":"NL","442":"LU","756":"CH","040":"AT","208":"DK","578":"NO",
  "752":"SE","246":"FI","616":"PL","203":"CZ","703":"SK","348":"HU","705":"SI",
  "191":"HR","070":"BA","688":"RS","499":"ME","807":"MK","008":"AL","300":"GR",
  "100":"BG","642":"RO","498":"MD","804":"UA","440":"LT","428":"LV","233":"EE",
  "352":"IS","792":"TR","196":"CY","470":"MT","020":"AD","492":"MC","674":"SM",
  "336":"VA","438":"LI","112":"BY","643":"RU"
};

async function loadTopology() {
  // 1) Intenta local (recomendado para 100% offline)
  try {
    const r = await fetch("./assets/countries-110m.json", { cache: "force-cache" });
    if (r.ok) return r.json();
    throw new Error("local not found");
  } catch {
    // 2) Fallback CDN
    const r = await fetch("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json");
    return r.json();
  }
}

function drawMap(topo) {
  // Base virtual 700x500; el SVG escalar√° con CSS (aspect-ratio)
  const W = 700, H = 500, PAD = 12;

  // Crea SVG
  container.innerHTML = "";
  const svgNS = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(svgNS, "svg");
  svg.setAttribute("viewBox", `0 0 ${W} ${H}`);
  svg.setAttribute("width", "100%");
  svg.setAttribute("height", "100%");
  container.appendChild(svg);

  const proj = geoMercator();
  const path = geoPath(proj, null);

  // Enfocar Europa con un bbox aproximado
  const europeBBox = { type:"Polygon", coordinates:[[[-25,32],[40,32],[40,72],[-25,72],[-25,32]]] };

  proj.fitExtent([[PAD, PAD], [W - PAD, H - PAD]], europeBBox);

  const countries = feature(topo, topo.objects.countries).features;

  // Dibujo
  const g = document.createElementNS(svgNS, "g");
  svg.appendChild(g);

  for (const f of countries) {
    const id = String(f.id).padStart(3, "0");
    const a2 = NUM_TO_A2[id]; // undefined si no mapeado (no pasa nada)
    const p = document.createElementNS(svgNS, "path");
    p.setAttribute("d", path(f));
    p.setAttribute("class", `country${a2 && ALLOWED.has(a2) ? " allowed" : ""}`);
    p.setAttribute("data-iso", a2 || id);
    g.appendChild(p);
  }
}

(async () => {
  const topo = await loadTopology();
  drawMap(topo);
})();
</script>


</body>
</html>
