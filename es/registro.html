<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro · unatomo</title>
  <meta name="description" content="Registro en unatomo." />
  <meta name="robots" content="noindex, nofollow" />

  <link rel="stylesheet" href="/styles.css">

  <style>html{visibility:hidden}</style>
</head>

<body class="page">
  <button id="theme-toggle" type="button" aria-label="Cambiar tema">
    ☾ / ☼
  </button>

  <header class="topbar">
    <div class="topbar-inner">
      <a href="/?setup=1" class="topbar-logo-link">
        <img
          src="/static/img/logo-unatomo-v1.5.svg"
          alt="unatomo"
          class="topbar-logo"
          loading="lazy"
        />
        <h2 class="topbar-title">Registro</h2>
      </a>
    </div>
  </header>

  <main class="shell page-shell">
    <section class="page-section" aria-label="Registro">
      <section class="card card--wide" aria-label="Formulario de registro">
        <button type="button" class="btn-secondary" id="google-register">
  Continuar con Google
</button>

<p id="reg-status" class="form-status" role="status" aria-live="polite" hidden></p>

    </section>

    <div id="legal-footer" class="legal-footer"></div>

    <div class="footer-link">
      <a href="/es/privacidad.html">Política de privacidad y cookies</a>
    </div>
  </main>

  <script src="/static/js/theme.js"></script>
  <script src="/static/js/functions.js"></script>
  <script src="/static/js/footer.js"></script>

<script type="module">
  import { validateRegistrationCode, signInWithGoogleAndCreateProfile } from "/static/js/registro/firebase-init.js";

  const status = document.getElementById("reg-status");
  const btn = document.getElementById("google-register");

  function setStatus(t) {
    status.hidden = false;
    status.textContent = t;
  }

  const code = (sessionStorage.getItem("unatomo_access_code") || "").trim();

  if (!code) {
    window.location.replace("/?setup=1");
  } else {
    const check = await validateRegistrationCode(code);
    if (!check.valid) {
      try { sessionStorage.removeItem("unatomo_access_code"); } catch (e) {}
      window.location.replace("/?setup=1");
    }
  }

  btn?.addEventListener("click", async () => {
    try {
      btn.disabled = true;
      setStatus("Conectando con Google…");

      const res = await signInWithGoogleAndCreateProfile(code);
      if (!res.ok) {
        setStatus("No se pudo completar el registro.");
        return;
      }

      setStatus("Registro completado. Redirigiendo…");
      setTimeout(() => {
        window.location.href = "/es/index.html";
      }, 650);
    } catch (e) {
      setStatus("Error en el registro con Google.");
    } finally {
      btn.disabled = false;
    }
  });
</script>


  
</body>
</html>
