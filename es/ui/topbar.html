<header class="topbar">
  <div class="topbar-inner" style="display:flex; align-items:center; justify-content:space-between; gap:1rem;">
    <a href="/?setup=1" class="topbar-logo-link">
      <img
        src="/static/img/logo-unatomo-v1.5.svg"
        alt="unatomo"
        class="topbar-logo"
        loading="lazy"
      />
      <h2 class="topbar-title" id="topbar-title">Inicio</h2>
    </a>

    <div class="topbar-actions" aria-label="Sesión"
         style="display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap; justify-content:flex-end;">

      <div id="session-menu-wrap" style="position:relative; display:inline-flex; margin-right:0.5rem;">
        <button
          id="session-menu-btn"
          type="button"
          aria-label="Menú de usuario"
          aria-haspopup="menu"
          aria-expanded="false"
          style="
            margin-top:0;
            padding: 6px 10px;
            min-width: 40px;
            min-height: 32px;
            border-radius: 0.75rem;
            border: 1px solid color-mix(in srgb, var(--fg) 55%, transparent);
            background: color-mix(in srgb, var(--bg) 80%, transparent);
            color: var(--fg);
            font: inherit;
            font-size: 0.9rem;
            cursor: pointer;
            opacity: 0.9;
            backdrop-filter: blur(8px);
            -webkit-tap-highlight-color: transparent;
            appearance: none;
            -webkit-appearance: none;
            box-shadow: none;
            filter: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
          "
        >
          <svg
            viewBox="0 0 24 24"
            aria-hidden="true"
            focusable="false"
            style="width:18px; height:18px; display:block;"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="8" r="4"></circle>
            <path d="M4 21c1.8-4 5-6 8-6s6.2 2 8 6"></path>
          </svg>
        </button>

        <div
          id="session-menu"
          role="menu"
          hidden
          style="
            position:absolute;
            right:0;
            top:calc(100% + 8px);
            min-width: 210px;
            background: var(--panel-bg);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 10px;
            text-align:left;
            box-shadow: 0 10px 30px rgba(0,0,0,18);
            z-index: 999;
          "
        >
          <div
            id="session-menu-label"
            style="
              font-size: 0.95rem;
              opacity: .85;
              padding: 6px 8px 10px 8px;
              border-bottom: 1px solid var(--border-subtle);
              margin-bottom: 10px;
              word-break: break-word;
            "
          >
            Invitado
          </div>

          <button
            id="session-menu-action"
            type="button"
            role="menuitem"
            class="btn-secondary"
            style="width:100%; margin:0; justify-content:center;"
          >
            Iniciar sesión
          </button>

          <button
            id="session-menu-register"
            type="button"
            role="menuitem"
            class="btn-secondary"
            style="width:100%; margin-top:8px; justify-content:center;"
          >
            Registrarse
          </button>
        </div>
      </div>

      <button
        id="theme-toggle"
        type="button"
        aria-label="Cambiar tema"
        style="
          margin-top:0;
          position:static;
          top:auto; right:auto; left:auto;
          transform:none;
        "
      >
        ☾ / ☼
      </button>

    </div>
  </div>
</header>
